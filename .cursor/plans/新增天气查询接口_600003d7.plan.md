---
name: 新增天气查询接口
overview: 新增 GET 天气查询接口：入参城市中文名，服务端调用高德地理编码获取 adcode 后查询实时天气，返回 JSON（天气、温度、穿衣建议）。
todos:
  - id: add-config
    content: 在 application.properties 增加 amap.key 配置项
    status: completed
  - id: amap-client
    content: 实现高德地理编码与实时天气调用（RestClient + DTO）
    status: completed
    dependencies:
      - add-config
  - id: clothing-advice
    content: 实现穿衣建议生成逻辑（按温度/雨雪）
    status: completed
    dependencies:
      - amap-client
  - id: weather-endpoint
    content: 新增 /weather Controller，返回 JSON（weather/temperature/clothingAdvice）并补齐错误处理
    status: completed
    dependencies:
      - clothing-advice
---

# 新增天气查询接口（高德）

## 目标

- 新增 `GET /weather?city=城市名` 接口
- 返回 JSON：`weather`（天气情况）、`temperature`（温度）、`clothingAdvice`（建议穿衣字数）

## 设计约定

- **入参**：`city`（必填，中文城市名）
- **高德调用链**：地理编码 `/v3/geocode/geo` → 取 `adcode` → 实时天气 `/v3/weather/weatherInfo?extensions=base`
- **配置**：在 [`/Users/yongsheng.hang/luckin/java-demo/src/main/resources/application.properties`](/Users/yongsheng.hang/luckin/java-demo/src/main/resources/application.properties) 增加 `amap.key=...`
- **HTTP 客户端**：使用 Spring Boot 3.2 自带的 `RestClient`（无需新增依赖）
- **错误处理**：
- `city` 为空或找不到 `adcode` → 400
- 上游高德失败/返回异常 → 502

## 需要改动/新增的文件

- 新增 Controller：`/Users/yongsheng.hang/luckin/java-demo/src/main/java/com/luckin/javademo/WeatherController.java`
- 新增服务与高德客户端：`/Users/yongsheng.hang/luckin/java-demo/src/main/java/com/luckin/javademo/weather/*`
- 更新配置：[`/Users/yongsheng.hang/luckin/java-demo/src/main/resources/application.properties`](/Users/yongsheng.hang/luckin/java-demo/src/main/resources/application.properties)

## 实现步骤

- 在 `application.properties` 增加 `amap.key`
- 新增 `AmapClient`：
- `geocode(cityName) -> adcode`
- `liveWeather(adcode) -> weather + temperature`
- 新增 `ClothingAdvisor`：根据温度（及是否雨雪）生成 `clothingAdvice`
- 新增 `WeatherController`：组合上述逻辑并返回固定 JSON 结构